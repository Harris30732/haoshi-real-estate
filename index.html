<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="好室房產集團 - 青埔地區房屋銷售資料管理系統 Pro">
  <title>好室房產 | 房屋銷售資料管理系統 Pro</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Styles -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
</head>

<body>
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p class="text-muted">載入中...</p>
  </div>

  <!-- ==================== Login Page ==================== -->
  <div id="loginPage" class="login-page hidden">
    <div class="login-container animate-scaleIn">
      <div class="login-logo">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 3L4 9v12h16V9l-8-6zm0 2.18L18 10v9H6v-9l6-4.82zM10 14h4v5h-4v-5z" />
        </svg>
      </div>
      <h1 class="login-title">House 好室房產集團</h1>
      <p class="login-subtitle">Professional Real Estate Services</p>

      <button id="googleLoginBtn" class="google-login-btn">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path fill="#4285F4"
            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
          <path fill="#34A853"
            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
          <path fill="#FBBC05"
            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
          <path fill="#EA4335"
            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
        </svg>
        使用 Google 帳號登入
      </button>

      <div id="loginError" class="login-error hidden">
        <span id="loginErrorText"></span>
      </div>
    </div>
  </div>

  <!-- ==================== Main App ==================== -->
  <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="header header-compact">
      <div class="header-top container-fluid">
        <!-- Brand (links to home) -->
        <a href="#" class="header-brand" onclick="window.location.reload(); return false;">
          <div class="header-logo">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 3L4 9v12h16V9l-8-6zm0 2.18L18 10v9H6v-9l6-4.82zM10 14h4v5h-4v-5z" />
            </svg>
          </div>
          <div class="header-brand-text">
            <div class="header-brand-name">House 好室房產集團</div>
            <div class="header-brand-slogan">青埔地區房屋銷售資料管理系統 Pro</div>
          </div>
        </a>

        <!-- User Menu -->
        <div class="header-user">
          <span class="version-badge">Pro v2.0</span>
          <button id="userAvatarBtn" class="user-avatar-btn">
            <img id="userAvatarImg" src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff"
              alt="User Avatar">
          </button>

          <div id="userDropdown" class="user-dropdown">
            <div class="user-dropdown-header">
              <div id="userDisplayName" class="user-dropdown-name">使用者</div>
              <div id="userEmail" class="user-dropdown-email">user@example.com</div>
            </div>
            <div class="user-dropdown-menu">
              <div id="menuCommunityManage" class="dropdown-item" onclick="openModal('communityModal')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                  <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
                社區資料管理
              </div>
              <div id="menuUserManage" class="dropdown-item" onclick="openModal('userModal')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                  <circle cx="9" cy="7" r="4" />
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                成員管理
              </div>
              <div class="dropdown-divider"></div>
              <div class="dropdown-item danger" onclick="logout()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <polyline points="16 17 21 12 16 7" />
                  <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                登出
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <!-- Chart Section -->
        <section class="chart-section">
          <div class="card chart-card">
            <div class="card-header">
              <h3 class="card-title">
                <span>📊</span>
                <span id="chartTitle">青埔地區房市分析</span>
              </h3>
              <div class="chart-toggle-container">
                <button id="chartToggleBtn" class="chart-toggle-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16v16H4z" />
                    <path d="M4 12h16" />
                    <path d="M12 4v16" />
                  </svg>
                  <span id="chartToggleText">總價區間分布</span>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="priceChartContainer" class="chart-container">
                <canvas id="priceChart"></canvas>
              </div>
              <div id="communityChartContainer" class="chart-container hidden">
                <canvas id="communityChart"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- Properties Section -->
        <section class="properties-section">
          <div class="card">
            <!-- Tabs -->
            <div class="properties-tabs">
              <button id="tabActive" class="properties-tab active-tab active" onclick="switchTab('active')">
                <span class="dot"></span>
                在售物件 (<span id="activeCount">0</span>)
              </button>
              <button id="tabArchived" class="properties-tab archived-tab" onclick="switchTab('archived')">
                <span class="dot"></span>
                下架專區 (<span id="archivedCount">0</span>)
              </button>
            </div>

            <!-- Action Buttons -->
            <div id="actionButtons" class="action-buttons">
              <button class="action-btn action-btn-add" onclick="openPropertyModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19" />
                  <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                新增物件
              </button>
              <button class="action-btn action-btn-export" onclick="exportData()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="7 10 12 15 17 10" />
                  <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                匯出資料
              </button>
              <button class="action-btn action-btn-import" onclick="importData()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="17 8 12 3 7 8" />
                  <line x1="12" y1="3" x2="12" y2="15" />
                </svg>
                匯入資料
              </button>

            </div>

            <!-- Filters -->
            <div class="filters-row">
              <div class="filter-group">
                <label class="filter-label">價格範圍：</label>
                <input type="number" id="filterMinPrice" class="filter-input" placeholder="最低價">
                <span>-</span>
                <input type="number" id="filterMaxPrice" class="filter-input" placeholder="最高價">
              </div>
              <div class="filter-group">
                <label class="filter-label">房屋類型：</label>
                <select id="filterHouseType" class="filter-select">
                  <option value="">全部</option>
                  <option value="兩房">兩房</option>
                  <option value="套房">套房</option>
                  <option value="三房成3+1房">三房成3+1房</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">合約類型：</label>
                <select id="filterContractType" class="filter-select">
                  <option value="">全部</option>
                  <option value="專任">專任</option>
                  <option value="一般">一般</option>
                  <option value="屋主">屋主</option>
                  <option value="待確認">待確認</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">社區：</label>
                <select id="filterCommunity" class="filter-select">
                  <option value="">全部</option>
                </select>
              </div>
            </div>

            <!-- Data Table -->
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th class="col-community sortable" data-sort="community_name">社區名稱 ↕</th>
                    <th class="col-property sortable" data-sort="age">屋齡(年) ↕</th>
                    <th class="col-property">戶數</th>
                    <th class="col-price sortable" data-sort="total_price">總價(萬) ↕</th>
                    <th class="col-price sortable" data-sort="total_ping">總坪數 ↕</th>
                    <th class="col-price sortable" data-sort="parking_ping">車位坪數 ↕</th>
                    <th class="col-price sortable" data-sort="house_ping">房屋坪數 ↕</th>
                    <th class="col-price sortable" data-sort="parking_price">車位價格(萬) ↕</th>
                    <th class="col-price sortable" data-sort="unit_price">房屋單價(萬/坪) ↕</th>
                    <th class="col-property sortable" data-sort="floor_info">樓層 ↕</th>
                    <th class="col-property sortable" data-sort="address">地址 ↕</th>
                    <th class="col-property">房屋類型</th>
                    <th class="col-photo">照片</th>
                    <th class="col-property">合約類型</th>
                    <th class="col-meta">備註</th>
                    <th class="col-meta">維護資訊</th>
                    <th class="col-action">操作</th>
                  </tr>
                </thead>
                <tbody id="propertiesTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state hidden">
              <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
              </svg>
              <h4 class="empty-state-title">目前沒有物件</h4>
              <p class="empty-state-description">點擊「新增物件」按鈕開始新增第一筆資料</p>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination hidden">
              <button class="pagination-btn" id="prevPageBtn" onclick="prevPage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6" />
                </svg>
              </button>
              <div id="paginationNumbers"></div>
              <button class="pagination-btn" id="nextPageBtn" onclick="nextPage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6" />
                </svg>
              </button>
              <span class="pagination-info">
                共 <span id="totalItems">0</span> 筆
              </span>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- ==================== Modals ==================== -->

  <!-- Property Modal -->
  <div id="propertyModal" class="modal-backdrop">
    <div class="modal modal-lg">
      <div class="modal-header">
        <h3 class="modal-title" id="propertyModalTitle">新增物件</h3>
        <button class="modal-close-btn" onclick="closeModal('propertyModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="propertyForm">
          <input type="hidden" id="propertyId">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">社區名稱 *</label>
              <select id="propertyCommunity" class="form-select" required>
                <option value="">請選擇社區</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">總價 (萬) *</label>
              <input type="number" id="propertyTotalPrice" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">總坪數 *</label>
              <input type="number" id="propertyTotalPing" class="form-input" step="0.1" required>
            </div>
            <div class="form-group">
              <label class="form-label">車位坪數</label>
              <input type="number" id="propertyParkingPing" class="form-input" step="0.1">
            </div>
            <div class="form-group">
              <label class="form-label">車位價格 (萬)</label>
              <input type="number" id="propertyParkingPrice" class="form-input">
            </div>
            <div class="form-group">
              <label class="form-label">樓層資訊 *</label>
              <input type="text" id="propertyFloor" class="form-input" placeholder="如：8樓/共15樓" required>
            </div>
            <div class="form-group full-width">
              <label class="form-label">地址 *</label>
              <input type="text" id="propertyAddress" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">狀態 *</label>
              <select id="propertyStatus" class="form-select" required>
                <option value="專任">專任</option>
                <option value="一般">一般</option>
                <option value="已成交">已成交</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">格局 *</label>
              <input type="text" id="propertyLayout" class="form-input" placeholder="如：3房2廳2衛" required>
            </div>
            <div class="form-group full-width">
              <label class="form-label">備註</label>
              <textarea id="propertyNotes" class="form-input" rows="3"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('propertyModal')">取消</button>
        <button class="btn btn-primary" onclick="saveProperty()">儲存</button>
      </div>
    </div>
  </div>

  <!-- Community Modal -->
  <div id="communityModal" class="modal-backdrop">
    <div class="modal modal-xl">
      <div class="modal-header">
        <h3 class="modal-title">社區資料管理</h3>
        <button class="modal-close-btn" onclick="closeModal('communityModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Add New Community Form -->
        <div class="card mb-4" style="background: var(--gray-50); box-shadow: none;">
          <h4 class="font-semibold mb-4">新增 / 編輯社區</h4>
          <form id="communityForm">
            <input type="hidden" id="communityId">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">建商名稱 *</label>
                <input type="text" id="communityBuilder" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">社區名稱 *</label>
                <input type="text" id="communityName" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">完工年份 (民國) *</label>
                <input type="text" id="communityCompletionDate" class="form-input" placeholder="如：110" required>
              </div>
              <div class="form-group">
                <label class="form-label">總戶數 *</label>
                <input type="text" id="communityTotalUnits" class="form-input" required>
              </div>
              <div class="form-group full-width">
                <label class="form-label">坪數範圍 *</label>
                <input type="text" id="communityAreaRange" class="form-input" placeholder="如：30/40" required>
              </div>
            </div>
          </form>
          <div class="flex justify-end gap-2 mt-4">
            <button class="btn btn-secondary" onclick="resetCommunityForm()">重置</button>
            <button class="btn btn-primary" onclick="saveCommunity()">儲存社區</button>
          </div>
        </div>

        <!-- Community List -->
        <h4 class="font-semibold mb-4">現有社區列表</h4>
        <div class="community-filter-row mb-4">
          <input type="text" id="communitySearch" class="filter-input" placeholder="搜尋社區名稱或建商..."
            oninput="filterCommunityList()">
        </div>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th class="sortable" data-sort="builder" onclick="toggleCommunitySort('builder')">建商 ↕</th>
                <th class="sortable" data-sort="community_name" onclick="toggleCommunitySort('community_name')">社區名稱 ↕
                </th>
                <th class="sortable" data-sort="completion_date" onclick="toggleCommunitySort('completion_date')">完工年份 ↕
                </th>
                <th class="sortable" data-sort="total_units" onclick="toggleCommunitySort('total_units')">總戶數 ↕</th>
                <th>坪數範圍</th>
                <th>建立資訊</th>
                <th>維護資訊</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="communityTableBody">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('communityModal')">關閉</button>
      </div>
    </div>
  </div>

  <!-- User Modal -->
  <div id="userModal" class="modal-backdrop">
    <div class="modal modal-xl">
      <div class="modal-header">
        <h3 class="modal-title">成員管理</h3>
        <button class="modal-close-btn" onclick="closeModal('userModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Add New User Form -->
        <div class="card mb-4" style="background: var(--gray-50); box-shadow: none;">
          <h4 class="font-semibold mb-4">新增 / 編輯成員</h4>
          <form id="userForm">
            <input type="hidden" id="userId">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">姓名 *</label>
                <input type="text" id="userName" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Email *</label>
                <input type="email" id="userEmailInput" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">職稱</label>
                <input type="text" id="userTitle" class="form-input">
              </div>
              <div class="form-group">
                <label class="form-label">角色 *</label>
                <select id="userRole" class="form-select" required>
                  <option value="user">一般使用者 (user)</option>
                  <option value="manager">管理者 (manager)</option>
                  <option value="admin">系統管理員 (admin)</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">是否啟用</label>
                <select id="userIsActive" class="form-select">
                  <option value="true">啟用</option>
                  <option value="false">停用</option>
                </select>
              </div>
            </div>
          </form>
          <div class="flex justify-end gap-2 mt-4">
            <button class="btn btn-secondary" onclick="resetUserForm()">重置</button>
            <button class="btn btn-primary" onclick="saveUser()">儲存成員</button>
          </div>
        </div>

        <!-- User List -->
        <h4 class="font-semibold mb-4">現有成員列表</h4>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>姓名</th>
                <th>Email</th>
                <th>職稱</th>
                <th>角色</th>
                <th>狀態</th>
                <th>最後登入</th>
                <th>建立資訊</th>
                <th>維護資訊</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="userTableBody">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('userModal')">關閉</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">匯入資料</h3>
        <button class="modal-close-btn" onclick="closeModal('importModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">選擇檔案</label>
          <input type="file" id="importFile" class="form-input" accept=".csv,.json">
          <p class="text-sm text-muted mt-2">支援 CSV 或 JSON 格式</p>
        </div>
        <div id="importPreview" class="hidden mt-4">
          <h4 class="font-semibold mb-2">預覽資料</h4>
          <div id="importPreviewContent" class="table-wrapper" style="max-height: 200px; overflow-y: auto;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('importModal')">取消</button>
        <button class="btn btn-primary" id="confirmImportBtn" onclick="confirmImport()" disabled>確認匯入</button>
      </div>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div id="confirmDialog" class="modal-backdrop">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title" id="confirmDialogTitle">確認</h3>
        <button class="modal-close-btn" onclick="closeModal('confirmDialog')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p id="confirmDialogMessage">確定要執行此操作嗎？</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('confirmDialog')">取消</button>
        <button class="btn btn-danger" id="confirmDialogBtn" onclick="confirmDialogAction()">確認</button>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div id="photoModal" class="modal-backdrop">
    <div class="modal modal-lg">
      <div class="modal-header">
        <h3 class="modal-title">
          <span id="photoModalTitle">物件照片</span>
          <span id="photoModalPropertyName" class="text-muted text-sm"></span>
        </h3>
        <button class="modal-close-btn" onclick="closePhotoModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Preview Mode -->
        <div id="photoPreviewMode">
          <div id="photoCarousel" class="photo-carousel">
            <button class="carousel-nav prev" onclick="prevPhoto()" title="上一張">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6" />
              </svg>
            </button>
            <div class="carousel-main">
              <img id="carouselImage" src="" alt="物件照片">
              <div id="carouselEmpty" class="carousel-empty hidden">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21 15 16 10 5 21" />
                </svg>
                <p>暫無照片</p>
              </div>
            </div>
            <button class="carousel-nav next" onclick="nextPhoto()" title="下一張">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6" />
              </svg>
            </button>
          </div>
          <div id="photoThumbnails" class="photo-thumbnails"></div>
          <div id="photoCounter" class="photo-counter"></div>
        </div>

        <!-- Edit Mode -->
        <div id="photoEditMode" class="hidden">
          <!-- Upload Zone -->
          <div id="photoUploadZone" class="photo-upload-zone" ondragover="handleDragOver(event)"
            ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            <p>拖放照片至此處上傳</p>
            <p class="text-sm text-muted">或點擊選擇檔案 (JPG, PNG, 最大 10MB)</p>
            <input type="file" id="photoFileInput" accept="image/jpeg,image/png" multiple
              onchange="handleFileSelect(event)" hidden>
            <button class="btn btn-outline-primary mt-3" onclick="document.getElementById('photoFileInput').click()">
              選擇檔案
            </button>
          </div>

          <!-- Upload Progress -->
          <div id="uploadProgress" class="upload-progress hidden">
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
            <span id="progressText">上傳中...</span>
          </div>

          <!-- Photo Grid -->
          <div id="photoGrid" class="photo-grid"></div>
        </div>
      </div>
      <div class="modal-footer">
        <div id="photoEditActions" class="hidden">
          <span id="photoEditHint" class="text-sm text-muted">點擊照片設為封面，或點擊刪除按鈕移除</span>
        </div>
        <button class="btn btn-secondary" onclick="closePhotoModal()">關閉</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>
  <script src="js/charts.js"></script>
  <script src="js/table.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/import-export.js"></script>
  <script src="js/app.js"></script>
</body>

</html>